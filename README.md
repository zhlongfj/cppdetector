# cppdetector

<center>
    <a href="https://github.com/zhlongfj/cppdetector" target="_blank" rel="noopener noreferrer">
        <img src="https://img.shields.io/github/issues/zhlongfj/cppdetector?style=flat-square" alt="version"/>
    </a>
    <a href="https://github.com/zhlongfj/cppdetector" target="_blank" rel="noopener noreferrer">
        <img src="https://img.shields.io/github/repo-size/zhlongfj/cppdetector?style=flat-square" alt="version"/>
    </a>
    <a href="https://github.com/zhlongfj/cppdetector" target="_blank" rel="noopener noreferrer">
        <img src="https://img.shields.io/github/stars/zhlongfj/cppdetector" alt="version"/>
    </a>
    <a href="https://github.com/zhlongfj/cppdetector" target="_blank" rel="noopener noreferrer">
        <img src="https://img.shields.io/github/languages/count/zhlongfj/cppdetector?style=flat-square" alt="version"/>
    </a>
    <a href="https://github.com/zhlongfj/cppdetector" target="_blank" rel="noopener noreferrer">
        <img src="https://img.shields.io/github/forks/zhlongfj/cppdetector" alt="version"/>
    </a>
    <a href="https://github.com/zhlongfj/cppdetector" target="_blank" rel="noopener noreferrer">
        <img src="https://img.shields.io/github/license/zhlongfj/cppdetector" alt="version"/>
    </a>
</center>

## :large_blue_circle: Internationalization

English | [中文文档](README_zh.md)

## :information_source: Introductions

Cppdector was inspired by [TscanCode](https://github.com/Tencent/TscanCode). In the process of using [TscanCode](https://github.com/Tencent/TscanCode), it was found that [TscanCode](https://github.com/Tencent/TscanCode) lacked some detection items required by the team, such as:

* Declare a member variable of public  
* Lambda captures all variables by reference  
* [Google c++ style](https://google.github.io/styleguide/cppguide.html), such as: define [static and global variables](https://google.github.io/styleguide/cppguide.html#Static_and_Global_Variables)   

Cppdetector absorbs some of the rules in [TscanCode]([TscanCode](https://github.com/Tencent/TscanCode)) and adds some principles in real development ([non-thread-safe singleton pattern detection](todo)), [Google c++ style](https://google.github.io/styleguide/cppguide.html), [effectvie c++](todo) and other programming specifications to help programmers find defects and improve code quality from the start.    

Cppdetector detects codes through regular and string matches.  When detecting, there is no need to compile the code being tested.

## :eight_spoked_asterisk: Compile Environment
Any compiler that supports C++17(filesystem) will work. 

Alternative compilers: 

* Visual Studio 2017 version 15.7(or above)
* Linux：GCC 8.0(or later)
* Mac：clang 7.0(or later)

## :gem: Compile
Cppdetector uses `Cmake` for engineering configuration
### Windows
#### cmake command

```
//cd to the cppdetector directory  
mkdir build 
cd build
cmake ..
cmake --build . --config RelWithDebInfo
//you can Open the cppdetector.sln to compile in the Build directory  
```
#### IDE open cmake project

* clion opens the root directory of the cppdetector  
* Visual Studio->"Open Local Folder" and select root directory of the cppdetector

#### run script to build
```
cd buildscript
buildwithcmd.bat
```

### Mac
#### cmake command

```
//cd to the cppdetector directory  
mkdir build
cd build
cmake ..
cmake --build . --config RelWithDebInfo
#you can build with multi-core, eg: 6 core
#cmake --build . --config RelWithDebInfo -j6
//you can compile with `make` on Linux and Mac
//make
```
####I DE open cmake project

* clion opens the root directory of the cppdetector 

## :gem: Run
### Windows
`cppdetector multithread "codepath"`
### Mac
`./cppdetector multithread /Users/hualongzhang/work/cppdetector/detector_core`

## Parameter

Parameter  | Description
------------- | -------------
Param1  | singlethread, multithread or multiprocess 
Param2  | Path of code
Param3 | Path of exception config
Param4 | Path of rule names config
Param5 | Path of result

### Exception Config File

```
[
    "/Users/hualongzhang/work/cppdetector/detector_core/3rdparty",
    "/Users/hualongzhang/work/cppdetector/detector_core/common/codeconversion.h"
]
```
### Rule Names Config
Rule names config can be generated by code
`DetectorCommon().setDetectorRuleNames((resultDir / "detectorRuleNames.json").string()`

eg: Array rule:

```
{
	"ArrayDetector": [
		"ArrayRuleIndexOutOfBounds",
		"ArrayRuleIndexUsedBeforeCheck",
		"ArrayRuleIndexCheckDefectively",
		"ArrayRuleBufferOverflow",
		"ArrayRuleIndexOutOfBoundsFromFunc",
		"ArrayRuleIndexOutOfBoundsInLoop",
		"ArrayRuleMemsetZeroByte"
	]
}
```

### Possible Ways

```
./cppdetector multithread "/Users/hualongzhang/work/cppdetector/detector_core"
./cppdetector multithread "/Users/hualongzhang/work/cppdetector/detector_core" "/Users/hualongzhang/work/cppdetector" 
./cppdetector multithread "/Users/hualongzhang/work/cppdetector/detector_core" "/Users/hualongzhang/work/cppdetector" "/Users/hualongzhang/work/cppdetector/supporting/exceptionconfig.json"
./cppdetector multithread "/Users/hualongzhang/work/cppdetector/detector_core" "/Users/hualongzhang/work/cppdetector" "/Users/hualongzhang/work/cppdetector/supporting/exceptionconfig.json" 
./cppdetector multithread "/Users/hualongzhang/work/cppdetector/detector_core" "/Users/hualongzhang/work/cppdetector" "/Users/hualongzhang/work/cppdetector/supporting/exceptionconfig.json" 
"/Users/hualongzhang/work/cppdetector/supporting/detectorRuleNames.json"
./cppdetector multithread "/Users/hualongzhang/work/cppdetector/detector_core" "/Users/hualongzhang/work/cppdetector" "/Users/hualongzhang/work/cppdetector/supporting/exceptionconfig.json" 
"/Users/hualongzhang/work/cppdetector/supporting/detectorRuleNames.json" /Users/hualongzhang/work/cppdetector/bin/detectorResult
```

## :gift:测试
### windows

run script to test cppdetector, you can also detect other code with changing code in run.bat

```
cd cppdetector\release\windows_x64
run.bat
```

## :stuck_out_tongue_winking_eye: Authors

github: [zhlongfj](https://github.com/zhlongfj)

email: zhlongfj@sina.com

## :copyright: License

[License MIT](LICENSE)

[badags](https://shields.io/category/social)
[Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html)